<div class="exams-container">
  <h2>Exams</h2>

  <div *ngIf="error" class="error-message">{{ error }}</div>

  <div class="exam-form">
    <h3>Add New Exam</h3>
    <div class="input-group">
      <input type="text" [(ngModel)]="newExam.nameExam" placeholder="Exam Name">
      <input type="text" [(ngModel)]="newExam.classroom" placeholder="Classroom">
      <select [(ngModel)]="newExam.subjectId">
        <option value="0" disabled>Select Subject</option>
        <option *ngFor="let subject of subjects" [value]="subject.subjectId">
          {{ subject.nameSubject }}
        </option>
      </select>
    </div>
    <div class="input-group">
      <input type="date" [(ngModel)]="newExam.examDate">
      <select [(ngModel)]="newExam.examType">
        <option value="EXAM">Exam</option>
        <option value="QUIZ">Quiz</option>
        <option value="FINAL">Final</option>
      </select>
      <button (click)="isEditing ? updateExam() : addExam()">{{ isEditing ? 'Update Exam' : 'Add Exam' }}</button>
      <button *ngIf="isEditing" (click)="cancelEdit()" style="background-color: #bdc3c7; margin-left: 10px;">Cancel</button>
    </div>
  </div>

  <div class="exam-filters">
    <label>Filter by Subject:</label>
    <select [(ngModel)]="selectedSubjectId">
      <option [ngValue]="null">All Subjects</option>
      <option *ngFor="let s of subjects" [ngValue]="s.subjectId">
        {{ s.nameSubject }}
      </option>
    </select>
  </div>

  <div class="exam-list">
    <table>
      <thead>
        <tr>
          <th>Done</th>
          <th>Name</th>
          <th>Type</th>
          <th>Date</th>
          <th>Classroom</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let exam of filteredExams" [ngStyle]="{'background-color': getSubjectColor(exam.subjectId) + '33', 'border-left': '5px solid ' + getSubjectColor(exam.subjectId)}">
          <td>
            <button (click)="toggleComplete(exam)" [style.background-color]="exam.isCompleted ? '#2ecc71' : '#bdc3c7'" class="toggle-btn">
              {{ exam.isCompleted ? 'TRUE' : 'FALSE' }}
            </button>
          </td>
          <td [class.completed]="exam.isCompleted" style="font-weight: 600;">{{ exam.nameExam }}</td>
          <td>{{ exam.examType }}</td>
          <td>
            <div>{{ exam.examDate }}</div>
            <small [style.color]="getDaysRemaining(exam.examDate) === 'Overdue' ? '#e74c3c' : '#7f8c8d'" style="font-weight: bold;">
              {{ getDaysRemaining(exam.examDate) }}
            </small>
          </td>
          <td>{{ exam.classroom }}</td>
          <td>
            <button (click)="editExam(exam)" style="background-color: #f39c12; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Modify</button>
            <button class="delete-btn" (click)="deleteExam(exam.examId)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
